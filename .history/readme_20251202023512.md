# Proyecto Hosting NIPL

Resumen rápido
- Repositorio para la plataforma de microservicios (backend Flask + frontend React + proxy Traefik).
- Este README contiene enlaces a los templates dockerizados, al vídeo de demostración y al documento técnico requerido.

**Enlaces importantes**
- **Repositorios con templates dockerizados:** [REPOSITORIOS_TEMPLATES_PLACEHOLDER](https://example.com/your-templates)
- **Vídeo de demostración (YouTube):** [VIDEO_DEMO_PLACEHOLDER](https://youtube.com/your-demo)
- **Documento técnico:** `docs/technical.md` (puedes añadir el documento técnico aquí o cambiar el enlace) 

**Demostración (video) — pasos a mostrar**
- Registro e inicio de sesión:
  - Muestra la página de registro, completar formulario y verificar inicio de sesión.
- Creación y despliegue de un proyecto:
  - Crear nuevo proyecto desde `CrearProyecto` en el frontend, enviar código/URL o plantilla, y pulsar "Desplegar".
  - Mostrar cómo el backend construye la imagen y crea el contenedor (Traefik registra la ruta).
- Gestión de recursos y apagado automático:
  - Mostrar los campos CPU / Memoria / Rate limit en el formulario.
  - Mostrar en el panel (`PanelPrincipal`) los límites aplicados al proyecto.
  - Demostrar el apagado automático por inactividad (esperar el periodo configurado o forzar la comprobación) y ver el hilo de limpieza en `server.py`.

**Documento técnico (resumen y contenido esperado)**
El documento técnico debe incluir los siguientes apartados (archivo sugerido: `docs/technical.md`):

- **Descripción de la arquitectura y componentes**
  - Backend: `backend/app` (Flask) — expone API para autenticación, gestión de proyectos, y orquestación de contenedores.
  - Frontend: `frontend` (React) — interfaz para crear proyectos, ver estado y acciones (deploy/start/stop/delete).
  - Proxy: Traefik (`proxy/`) — router reverso basado en labels Docker; middleware de rate-limiting y forward_auth.
  - Docker / Docker SDK: backend usa Docker SDK para construir e iniciar contenedores; Traefik usa labels para crear routers/middlewares.

- **Flujo de trabajo del sistema**
  1. Usuario crea proyecto desde el frontend (formulario con CPU, memoria, rate limit).
  2. Frontend llama a la API `/projects/deploy` en el backend.
  3. Backend construye la imagen, crea el contenedor con labels Traefik y flags de recursos (`nano_cpus`, `mem_limit`).
  4. Traefik detecta las labels y crea el router/service; aplica middlewares de rate-limit y forward_auth.
  5. Cleanup thread en `backend/app/cleanup.py` detiene proyectos inactivos pasados los umbrales configurados.

- **Estrategia de seguridad y optimización de recursos**
  - Seguridad:
    - Autenticación con Blueprint `auth` y rutas protegidas.
    - `forward_auth` para que Traefik consulte el backend antes de permitir el acceso al servicio.
    - Validación y saneamiento de entradas antes de ejecutar builds/containers.
  - Optimización de recursos:
    - Uso de `nano_cpus` y `mem_limit` al crear contenedores.
    - Rate limiting por proyecto aplicado vía middlewares de Traefik.
    - Apagado automático (idle) y limpieza periódica para liberar recursos.

**Cómo ejecutar (local, reproducible)**
1. Crear red de proxy (si aún no existe):
```
docker network create traefik-net
```
2. Levantar solo el proxy (opcional):
```
cd proxy
docker compose up -d
```
3. Desde la raíz del repo construir y levantar la aplicación (usa BuildKit para mejor rendimiento):
```
# En PowerShell (temporalmente habilitar BuildKit)
$env:DOCKER_BUILDKIT=1
$env:COMPOSE_DOCKER_CLI_BUILD=1
docker compose up --build -d
```
4. Ver servicios y logs:
```
docker compose ps
docker logs -f proyecto_backend
docker logs -f proyecto_frontend
docker logs -f proyecto_traefik
```

**Modo desarrollo (hot-reload)**
- Si quieres editar y ver cambios rápidos, usa un `docker-compose.dev.yml` (no incluido por defecto) que monte los volúmenes `./frontend` y `./backend` y ejecute `npm start` / `python server.py` en foreground.

**Problemas conocidos y soluciones rápidas**
- Build lento por contexto grande: añadir `.dockerignore` en la raíz y en `frontend/` y `backend/` (ya incluido) para excluir `node_modules`, `build`, `venv`, `.git`, etc.
- Traefik devuelve 504 por `forward_auth` apuntando a `host.docker.internal`: solución recomendada — usar la URL interna del backend (`http://proyecto_backend:8000/...`) o asegurarse de que `proyecto_traefik` esté en la red `traefik-net`.
- Contenedores con etiqueta `rateLimit.average="1.0"` antiguos pueden producir errores en Traefik; recrear esos contenedores para que reciban las etiquetas correctas (sin punto decimal).

**Archivos y rutas relevantes**
- `docker-compose.yml` (raíz): orquesta `backend`, `frontend`, `traefik`.
- `backend/Dockerfile`, `frontend/Dockerfile`.
- `backend/app/server.py`, `backend/app/models/containers_models.py` (lógica de creación de contenedores y labels Traefik).
- `proxy/traefik.yml`, `proxy/traefik_dynamic.yml`, `proxy/docker-compose.yml`.
- `scripts/connect-traefik-net.ps1` — helper para crear/conectar Traefik a la red `traefik-net` de forma robusta.

Si quieres, puedo generar el `docs/technical.md` completo a partir del resumen anterior, o añadir los enlaces reales (repositorios y vídeo) en este README si me los facilitas.
